<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>NBA GM Simulator v2.0</title>
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; }
#app { max-width: 1000px; margin:auto; padding:20px; }
h2 { text-align:center; }
section { background:#fff; padding:15px; margin-bottom:15px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
button { padding:6px 10px; margin:4px; border:none; border-radius:4px; cursor:pointer; background:#007bff; color:white; }
button:hover { background:#0056b3; }
select { padding:4px; margin:4px 0; }
.player-card { display:inline-block; background:#e3e3e3; margin:4px; padding:6px 8px; border-radius:4px; min-width:120px; text-align:center; }
.stats { margin-top:6px; font-size:0.9em; color:#333; }
</style>
</head>
<body>
<div id="app"></div>
<script>
// ===== 基本資料 =====
const ACTIVE_TEAMS = ["Golden State Warriors","Los Angeles Lakers","Cleveland Cavaliers","San Antonio Spurs","Oklahoma City Thunder"];
const NBA_PLAYER_POOL = [
{name:"Stephen Curry",pos:"PG",ovr:88},{name:"LeBron James",pos:"SF",ovr:90},{name:"Kevin Durant",pos:"PF",ovr:89},{name:"Giannis Antetokounmpo",pos:"PF",ovr:91},
{name:"Luka Dončić",pos:"PG",ovr:89},{name:"Joel Embiid",pos:"C",ovr:90},{name:"Nikola Jokić",pos:"C",ovr:92},{name:"Jayson Tatum",pos:"SF",ovr:87},
{name:"Ja Morant",pos:"PG",ovr:85},{name:"Devin Booker",pos:"SG",ovr:84},{name:"Donovan Mitchell",pos:"SG",ovr:85},{name:"Trae Young",pos:"PG",ovr:84}
];

// ===== 狀態 =====
let futureNBAPlayers=[...NBA_PLAYER_POOL];
let gameState={
 season:1,
 team:null,
 roster:[],
 aiTeams:{},
 freeAgents:[],
 drafted:0,
 gamesPlayed:0,
 totalGames:20,
 wins:0,
 losses:0,
 mvp:null
};
const MAX_SIGN=2;
const MIN_ROSTER_SIZE=8;

// ===== 工具 =====
function createPlayer(tpl,age=18){return {name:tpl.name,pos:tpl.pos,ovr:tpl.ovr,age,salary:5,assigned:false};}
function teamPower(roster){return roster.reduce((s,p)=>s+p.ovr,0)/Math.max(roster.length,1);}
function pickMVP(allTeams){
 let candidates=[];
 Object.values(allTeams).forEach(t=>candidates.push(...t.roster));
 candidates.push(...gameState.roster);
 if(candidates.length===0) return null;
 candidates.sort((a,b)=> (b.ovr+Math.random()*5)-(a.ovr+Math.random()*5));
 return candidates[0];
}

// ===== 初始化 =====
function startSeason(){
 gameState.aiTeams={};
 ACTIVE_TEAMS.forEach(t=>{
   if(t!==gameState.team) gameState.aiTeams[t]={roster:[]};
 });
 // 自由球員池
 gameState.freeAgents=[];
 let count=Math.min(6,futureNBAPlayers.length);
 for(let i=0;i<count;i++){
  let p=createPlayer(futureNBAPlayers.shift(),18);
  p.assigned=true;
  gameState.freeAgents.push(p);
 }
 gameState.drafted=0;
}

// ===== 簽約 =====
function signPlayer(i){
 if(gameState.drafted>=MAX_SIGN) return alert("本季最多簽兩人");
 let p=gameState.freeAgents.splice(i,1)[0];
 gameState.roster.push(p);
 gameState.drafted++;
 render();
}

function finishSigning(){
 distributeRemaining();
 render();
}

function distributeRemaining(){
 const aiNames=Object.keys(gameState.aiTeams);
 gameState.freeAgents.forEach((p,i)=>{
  const team=gameState.aiTeams[aiNames[i%aiNames.length]];
  if(team.roster.length<MIN_ROSTER_SIZE) team.roster.push(p);
 });
 gameState.freeAgents=[];
}

// ===== AI 補齊 =====
function fillTeam(r,isAI){
 if(isAI){
   while(r.length<MIN_ROSTER_SIZE){
     let p=futureNBAPlayers.find(p=>!p.assigned);
     if(!p) break;
     p.assigned=true;
     r.push(createPlayer(p,18));
   }
 }
}

// ===== 例行賽 =====
function simulateSeason(){
 while(gameState.gamesPlayed<gameState.totalGames){
  const myP=teamPower(gameState.roster);
  let league=0,c=0;
  Object.values(gameState.aiTeams).forEach(t=>{if(t.roster.length){league+=teamPower(t.roster);c++;}});
  league=c?league/c:myP;
  Math.random()<myP/(myP+league)?gameState.wins++:gameState.losses++;
  gameState.gamesPlayed++;
 }
 gameState.mvp=pickMVP(gameState.aiTeams);
 render();
 alert(`例行賽結束：${gameState.wins}勝 ${gameState.losses}敗\n當季MVP: ${gameState.mvp.name} (${gameState.mvp.pos}, OVR:${gameState.mvp.ovr})`);
 nextSeason();
}

// ===== 新賽季 =====
function nextSeason(){
 gameState.season++;
 gameState.gamesPlayed=0;
 gameState.wins=0;
 gameState.losses=0;
 gameState.roster.forEach(p=>p.age++);
 Object.values(gameState.aiTeams).forEach(t=>t.roster.forEach(p=>p.age++));
 startSeason();
 fillTeam(gameState.roster,false);
 Object.values(gameState.aiTeams).forEach(t=>fillTeam(t.roster,true));
 render();
}

// ===== UI =====
function selectTeam(){
 gameState.team=document.getElementById("teamSel").value;
 startSeason();
 render();
}

function render(){
 const app=document.getElementById("app");
 if(!gameState.team){
  app.innerHTML=`<h2>選擇球隊</h2>
   <select id="teamSel">${ACTIVE_TEAMS.map(t=>`<option>${t}</option>`).join("")}</select>
   <button id="startBtn">開始</button>`;
  document.getElementById("startBtn").addEventListener("click",selectTeam);
  return;
 }
 app.innerHTML=`
 <h2>第 ${gameState.season} 賽季｜${gameState.team}</h2>
 <section><b>你的球隊</b><br>${gameState.roster.map(p=>`<div class="player-card">${p.name}<br>${p.pos} | ${p.age}歲 | OVR:${p.ovr}</div>`).join("")||"空"}</section>
 <section><b>自由球員（可簽 ${MAX_SIGN-gameState.drafted} 人）</b><br>
 <div id="faList"></div>
 <button id="finishBtn">完成簽約</button></section>
 <section>
 <b>查看其他球隊名單</b><br>
 <select id="aiSel"><option value=''>選擇隊伍</option>
 ${Object.keys(gameState.aiTeams).map(t=>`<option>${t}</option>`).join("")}</select>
 <div id="aiRoster"></div></section>
 <section>
 <b>例行賽</b><br>
 <div>進度：${gameState.gamesPlayed}/${gameState.totalGames}</div>
 <div>戰績：${gameState.wins} 勝 ${gameState.losses} 敗</div>
 <div id="mvpInfo">${gameState.mvp?`當季MVP: ${gameState.mvp.name} (${gameState.mvp.pos}, OVR:${gameState.mvp.ovr})`:""}</div>
 <button id="simBtn">模擬例行賽</button>
 </section>
`;
 const faDiv=document.getElementById("faList");
 gameState.freeAgents.forEach((p,i)=>{
  const btn=document.createElement("button");
  btn.innerText=p.name;
  btn.addEventListener("click",()=>signPlayer(i));
  faDiv.appendChild(btn);
 });
 document.getElementById("finishBtn").addEventListener("click",finishSigning);
 document.getElementById("simBtn").addEventListener("click",simulateSeason);
 document.getElementById("aiSel").addEventListener("change",()=>{
  const sel=document.getElementById("aiSel");
  const name=sel.value;
  const div=document.getElementById("aiRoster");
  if(!name){div.innerHTML=""; return;}
  const roster=gameState.aiTeams[name].roster;
  div.innerHTML=roster.map(p=>`<div class="player-card">${p.name}<br>${p.pos} | ${p.age}歲 | OVR:${p.ovr}</div>`).join("")||"空";
 });
}

render();
</script>
</body>
</html>
