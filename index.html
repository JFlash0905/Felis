<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>NBA GM 單機版（更新 v0.6）</title>
<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
h1{margin-bottom:5px}
.version{color:red;font-weight:bold;margin-bottom:15px}
button{margin:4px;padding:6px 12px;cursor:pointer}
table{border-collapse:collapse;background:#fff;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px 10px;text-align:center}
#layout{display:flex;gap:20px}
#panel{background:#fff;padding:10px;min-width:220px}
.selected{background:#dff0ff}
.trade{color:orange;font-weight:bold}
</style>
</head>

<body>
<h1>NBA GM 單機版</h1>
<div class="version">（更新 v0.6｜建隊 + 養成 + 每季新秀）</div>

<h2>Step 1：選擇球隊</h2>
<select id="teamSelect"></select>
<button onclick="selectTeam()">開始 GM 生涯</button>

<div id="buildTeam" style="display:none">
<h2>建隊階段：選擇球員加入你的隊伍</h2>
<div id="salaryInfo"></div>
<table id="poolTable">
<thead>
<tr><th>球員</th><th>位置</th><th>OVR</th><th>薪資</th></tr>
</thead>
<tbody></tbody>
</table>
<button onclick="confirmTeam()">確認隊伍</button>
<div id="logBuild" style="margin-top:10px;background:#fff;padding:5px">選擇球員，注意薪資上限！</div>
</div>

<div id="game" style="display:none">
<h2 id="teamTitle"></h2>
<div id="layout">
<div>
<table id="roster">
<thead>
<tr><th>球員</th><th>位置</th><th>OVR</th><th>年齡</th><th>薪資</th></tr>
</thead>
<tbody></tbody>
</table>
</div>

<div id="panel">
<h3>球員操作</h3>
<div id="playerInfo">請選擇球員</div>
<button onclick="trainPlayer()">訓練（隨機）</button><br>
<button onclick="toggleTrade()">標記為交易籌碼</button>
<br><br>
<button onclick="nextSeason()">模擬下一季</button>
<br><br>
<button onclick="restartGame()">重啟生涯</button>
</div>
</div>
<div id="log" style="margin-top:15px;background:#fff;padding:10px">GM 準備就緒</div>
</div>

<script>
console.log("NBA GM v0.6 LOADED");

const SALARY_CAP=120; // 上限 $M
const INITIAL_POOL_SIZE=50; // 自由球員池初始人數
const NEW_DRAFT_PER_SEASON=30;

const teamData = {
 Warriors:[],Lakers:[],Celtics:[],Nuggets:[],Bucks:[]
};

let playerTeam=null;
let roster=[];
let pool=[];
let selectedPoolIndex=null;
let selectedRosterIndex=null;
let currentSalary=0;

// ===== 初始自由球員池 =====
function generatePlayer(namePrefix){
 let pos=["PG","SG","SF","PF","C"];
 return {
   name:namePrefix+Math.floor(Math.random()*100),
   pos:pos[Math.floor(Math.random()*pos.length)],
   ovr:Math.floor(Math.random()*19)+60,
   age:18,
   salary:Math.floor(Math.random()*6)+1,
   trade:false
 };
}

function initPool(){
 pool=[];
 for(let i=0;i<INITIAL_POOL_SIZE;i++) pool.push(generatePlayer("新人"));
}

// ===== 選隊 & 建隊 =====
const sel=document.getElementById("teamSelect");
Object.keys(teamData).forEach(t=>{
 let o=document.createElement("option");
 o.value=t;o.textContent=t;
 sel.appendChild(o);
});

function selectTeam(){
 playerTeam=sel.value;
document.getElementById("buildTeam").style.display="block";
document.getElementById("salaryInfo").textContent="薪資上限 $"+SALARY_CAP+"M，當前 $0M";
initPool();
renderPool();
}

function renderPool(){
 const tb=document.querySelector("#poolTable tbody");
 tb.innerHTML="";
 pool.forEach((p,i)=>{
  const tr=document.createElement("tr");
  if(i===selectedPoolIndex) tr.classList.add("selected");
  tr.innerHTML=`<td>${p.name}</td><td>${p.pos}</td><td>${p.ovr}</td><td>$${p.salary}M</td>`;
  tr.onclick=()=>{selectedPoolIndex=i;highlightPool();};
  tb.appendChild(tr);
 });
}

function highlightPool(){renderPool();}

function confirmTeam(){
 if(roster.length===0){alert("請選至少一名球員");return;}
 document.getElementById("buildTeam").style.display="none";
 document.getElementById("game").style.display="block";
 document.getElementById("teamTitle").textContent="你是 "+playerTeam+" 的 GM";
	saveGame();
	renderRoster();
	log("建隊完成！開始你的 GM 生涯");
}

// ===== GM 生涯 =====
function renderRoster(){
 const tb=document.querySelector("#roster tbody");
 tb.innerHTML="";
 roster.forEach((p,i)=>{
  const tr=document.createElement("tr");
  if(i===selectedRosterIndex) tr.classList.add("selected");
  tr.innerHTML=`<td>${p.name}${p.trade?" <span class='trade'>TRADE</span>":""}</td><td>${p.pos}</td><td>${p.ovr}</td><td>${p.age}</td><td>$${p.salary}M</td>`;
  tr.onclick=()=>{selectedRosterIndex=i;highlightRoster();};
  tb.appendChild(tr);
 });
}

function highlightRoster(){renderRoster();}

function selectPlayer(i){selectedRosterIndex=i;renderRoster();}

function trainPlayer(){
 if(selectedRosterIndex===null){alert("請先選球員");return;}
 const p=roster[selectedRosterIndex];
 let gain=0;
 if(p.age<=24) gain=Math.random()<0.7?1:0;
 else if(p.age<=30) gain=Math.random()<0.4?1:0;
 else gain=Math.random()<0.2?0:-1;
 p.ovr=Math.max(60,p.ovr+gain);
 log(`${p.name} 訓練結果：${gain>=0?"+":""}${gain}`);
 renderRoster();
	saveGame();
}

function toggleTrade(){
 if(selectedRosterIndex===null){alert("請先選球員");return;}
 const p=roster[selectedRosterIndex];
 p.trade=!p.trade;
 log(`${p.name} ${p.trade?"已":"取消"}列入交易名單`);
 renderRoster();
	saveGame();
}

// ===== 季度流程 =====
function nextSeason(){
 roster.forEach(p=>p.age++);
 addNewDraft();
	log("新賽季開始！新增新秀已加入自由球員池");
	renderRoster();
	saveGame();
}

function addNewDraft(){
 for(let i=0;i<NEW_DRAFT_PER_SEASON;i++) pool.push(generatePlayer("新人"));
	renderPool();
}

// ===== 存檔 / 讀檔 =====
function saveGame(){
 localStorage.setItem("NBA_GM_roster",JSON.stringify(roster));
 localStorage.setItem("NBA_GM_pool",JSON.stringify(pool));
 localStorage.setItem("NBA_GM_team",playerTeam);
}

function loadGame(){
 const r=localStorage.getItem("NBA_GM_roster");
 const p=localStorage.getItem("NBA_GM_pool");
 const t=localStorage.getItem("NBA_GM_team");
 if(r&&p&&t){
  roster=JSON.parse(r);
  pool=JSON.parse(p);
  playerTeam=t;
  document.getElementById("buildTeam").style.display="none";
  document.getElementById("game").style.display="block";
  document.getElementById("teamTitle").textContent="你是 "+playerTeam+" 的 GM";
  renderRoster();renderPool();
  log("讀取存檔完成！");
 }
}

function restartGame(){
 if(confirm("確定要刪除存檔並重啟生涯嗎？")){
  localStorage.clear();
  location.reload();
 }
}

// ===== 初始化 =====
window.addEventListener("DOMContentLoaded",()=>{loadGame();});
</script>
</body>
</html>
