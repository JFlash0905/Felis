<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>NBA GM v1.0 STABLE</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px }
h1 { margin-bottom:4px }
.red { color:red; font-weight:bold }
button { padding:6px 12px; margin:4px; cursor:pointer }
table { border-collapse:collapse; background:white; margin-top:10px }
th,td { border:1px solid #ccc; padding:6px 10px; text-align:center }
tr.click:hover { background:#e8f2ff; cursor:pointer }
#wrap { display:flex; gap:20px }
.box { background:white; padding:10px }
</style>
</head>

<body>
<h1>NBA GM v1.0</h1>
<div class="red">STABLE 版（選人、分配、模擬都正常）</div>

<div id="screen"></div>

<script>
/* ========= 核心狀態 ========= */
  const screen = document.getElementById("screen");
let state = {
  team: null,
  season: 1,
  roster: [],
  freeAgents: [],
  aiTeams: {}
};

const SALARY_CAP = 120;
const MAX_PICK = 2;

const TEAMS = ["Warriors","Lakers","Celtics","Bucks","Nuggets"];

const NBA_PLAYERS = [
 {name:"Stephen Curry",pos:"PG",ovr:78},
 {name:"LeBron James",pos:"SF",ovr:82},
 {name:"Kevin Durant",pos:"SF",ovr:80},
 {name:"Giannis Antetokounmpo",pos:"PF",ovr:81},
 {name:"Luka Doncic",pos:"PG",ovr:79},
 {name:"Joel Embiid",pos:"C",ovr:80},
 {name:"Jayson Tatum",pos:"SF",ovr:76},
 {name:"Ja Morant",pos:"PG",ovr:73},
 {name:"Jimmy Butler",pos:"SF",ovr:76},
 {name:"Damian Lillard",pos:"PG",ovr:77},
 {name:"Anthony Davis",pos:"PF",ovr:77},
 {name:"Kawhi Leonard",pos:"SF",ovr:78}
];

function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min}
function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}

/* ========= 初始化 ========= */
function startGame(){
  state.freeAgents = NBA_PLAYERS.map(p=>({
    ...p,
    age:18,
    salary: rand(5,15)
  }));
  shuffle(state.freeAgents);
  TEAMS.forEach(t=>{
    if(t!==state.team) state.aiTeams[t]=[];
  });
  renderBuild();
}

/* ========= 畫面 ========= */
function render(){
  if(!state.team) renderTeamSelect();
  else renderBuild();
}

function renderTeamSelect(){
  screen.innerHTML = `
    <h2>選擇你的球隊</h2>
    ${TEAMS.map(t=>`<button onclick="chooseTeam('${t}')">${t}</button>`).join("")}
  `;
}

function chooseTeam(t){
  state.team = t;
  startGame();
}

function renderBuild(){
  screen.innerHTML = `
  <h2>球隊：${state.team}｜第 ${state.season} 季</h2>
  <div id="wrap">
    <div class="box">
      <h3>自由球員（一次最多 2 人）</h3>
      <table>
        <tr><th></th><th>球員</th><th>位置</th><th>OVR</th><th>年齡</th><th>薪資</th></tr>
        ${state.freeAgents.map((p,i)=>`
          <tr class="click">
            <td><input type="checkbox" data-i="${i}"></td>
            <td>${p.name}</td>
            <td>${p.pos}</td>
            <td>${p.ovr}</td>
            <td>${p.age}</td>
            <td>$${p.salary}M</td>
          </tr>`).join("")}
      </table>
      <button onclick="pickPlayers()">加入隊伍</button>
      <button onclick="finishBuild()">完成建隊</button>
    </div>

    <div class="box">
      <h3>你的隊伍</h3>
      <table>
        <tr><th>球員</th><th>位置</th><th>OVR</th><th>年齡</th></tr>
        ${state.roster.map(p=>`
          <tr>
            <td>${p.name}</td>
            <td>${p.pos}</td>
            <td>${p.ovr}</td>
            <td>${p.age}</td>
          </tr>`).join("")}
      </table>
      <button onclick="nextSeason()">模擬下一季</button><br>
      <button onclick="restart()">重啟生涯</button>
    </div>
  </div>
  `;
}

/* ========= 行為 ========= */
function pickPlayers(){
  let checked=[...document.querySelectorAll("input[type=checkbox]:checked")];
  if(checked.length===0) return alert("請選球員");
  if(checked.length>MAX_PICK) return alert("一次最多 2 人");

  checked.sort((a,b)=>b.dataset.i-a.dataset.i).forEach(cb=>{
    let p = state.freeAgents.splice(cb.dataset.i,1)[0];
    state.roster.push(p);
  });
  render();
}

function finishBuild(){
  shuffle(state.freeAgents);
  Object.keys(state.aiTeams).forEach(t=>{
    while(state.aiTeams[t].length<2 && state.freeAgents.length){
      state.aiTeams[t].push(state.freeAgents.pop());
    }
  });
  alert("建隊完成！");
  render();
}

function nextSeason(){
  state.season++;
  state.roster.forEach(p=>p.age++);
  Object.values(state.aiTeams).flat().forEach(p=>p.age++);
  // 新秀
  state.freeAgents.push({
    name:"Rookie "+Math.floor(Math.random()*1000),
    pos:["PG","SG","SF","PF","C"][rand(0,4)],
    ovr:rand(60,68),
    age:18,
    salary:rand(4,8)
  });
  render();
}

function restart(){
  localStorage.clear();
  location.reload();
}

/* ========= 啟動 ========= */
render();
</script>
</body>
</html>
