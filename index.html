<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>NBA GM 單機版 v0.7.4 完整</title>
<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
h1{margin-bottom:5px}
.version{color:red;font-weight:bold;margin-bottom:15px}
button{margin:4px;padding:6px 12px;cursor:pointer}
table{border-collapse:collapse;background:#fff;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px 10px;text-align:center}
.selected{background:#dff0ff}
.trade{color:orange;font-weight:bold}
#layout{display:flex;gap:20px}
#panel{background:#fff;padding:10px;min-width:220px}
#aiPanel{background:#fff;padding:10px;margin-top:10px;display:none}
</style>
</head>
<body>
<h1>NBA GM 單機版</h1>
<div class="version">（v0.7.4 完整可玩版）</div>

<!-- 選隊 -->
<div id="selectTeamUI">
<h2>Step 1：選擇球隊</h2>
<select id="teamSelect"></select>
<button onclick="selectTeam()">開始 GM 生涯</button>
</div>

<!-- 建隊階段 -->
<div id="buildTeam" style="display:none">
<h2>建隊階段：選擇球員加入你的隊伍</h2>
<div id="salaryInfo"></div>
<table id="poolTable">
<thead>
<tr><th>球員</th><th>位置</th><th>OVR</th><th>薪資</th></tr>
</thead>
<tbody></tbody>
</table>
<h3>當前選中隊伍</h3>
<table id="rosterTable">
<thead>
<tr><th>球員</th><th>位置</th><th>OVR</th><th>薪資</th></tr>
</thead>
<tbody></tbody>
</table>
<div id="logBuild" style="margin-top:10px;background:#fff;padding:5px">選擇球員，注意薪資上限與隊伍人數！</div>
<button onclick="confirmTeam()">確認隊伍</button>
</div>

<!-- GM 生涯 -->
<div id="game" style="display:none">
<h2 id="teamTitle"></h2>
<div id="layout">
<div>
<h3>你的球隊</h3>
<table id="roster">
<thead>
<tr><th>球員</th><th>位置</th><th>OVR</th><th>年齡</th><th>薪資</th></tr>
</thead>
<tbody></tbody>
</table>

<h3>自由球員池（簽約新秀，每季最多 2 人）</h3>
<table id="freeAgents">
<thead>
<tr><th>選</th><th>球員</th><th>位置</th><th>OVR</th><th>薪資</th></tr>
</thead>
<tbody></tbody>
</table>
<button onclick="signFreeAgents()">簽約選中球員</button>
<h4 id="logFreeAgent" style="background:#fff;padding:5px;margin-top:5px">自由球員池</h4>
</div>

<div id="panel">
<h3>球員操作</h3>
<div id="playerInfo">請選擇球員</div>
<button onclick="trainPlayer()">訓練</button><br>
<button onclick="toggleTrade()">標記為交易籌碼</button>
<br><br>
<button onclick="nextSeason()">模擬下一季</button>
<br><br>
<button onclick="toggleAIView()">查看其他隊伍</button>
<div id="aiPanel"></div>
<br>
<button onclick="restartGame()">重啟生涯</button>
</div>
</div>
<div id="log" style="margin-top:15px;background:#fff;padding:10px">GM 準備就緒</div>
</div>

<script>
// ===== 設定 =====
const SALARY_CAP=120;
const MAX_PLAYERS=15;
const INITIAL_POOL_MIN=30;
const INITIAL_POOL_MAX=40;
const NEW_DRAFT_PER_SEASON=30;
const MAX_SIGN=2;
const MAX_AI_SIGN=2;

// NBA 球員清單（示例，建議補全） 
const nbaPlayers=[
{name:"LeBron James",pos:"SF",ovr:97},
{name:"Stephen Curry",pos:"PG",ovr:96},
{name:"Kevin Durant",pos:"PF",ovr:96},
{name:"Giannis Antetokounmpo",pos:"PF",ovr:97},
{name:"Kawhi Leonard",pos:"SF",ovr:94},
{name:"James Harden",pos:"SG",ovr:95},
{name:"Anthony Davis",pos:"PF",ovr:94},
{name:"Luka Doncic",pos:"PG",ovr:95},
{name:"Joel Embiid",pos:"C",ovr:96},
{name:"Nikola Jokic",pos:"C",ovr:97},
{name:"Damian Lillard",pos:"PG",ovr:93},
{name:"Jimmy Butler",pos:"SF",ovr:92},
{name:"Devin Booker",pos:"SG",ovr:91},
{name:"Zion Williamson",pos:"PF",ovr:90},
{name:"Donovan Mitchell",pos:"SG",ovr:91},
{name:"Jayson Tatum",pos:"SF",ovr:92},
{name:"Trae Young",pos:"PG",ovr:91},
{name:"Chris Paul",pos:"PG",ovr:90},
{name:"Paul George",pos:"SF",ovr:91},
{name:"Kyrie Irving",pos:"PG",ovr:91},
{name:"Bradley Beal",pos:"SG",ovr:89},
{name:"Karl-Anthony Towns",pos:"C",ovr:90},
{name:"DeMar DeRozan",pos:"SF",ovr:90},
{name:"Rudy Gobert",pos:"C",ovr:90},
{name:"Ja Morant",pos:"PG",ovr:90},
{name:"Bam Adebayo",pos:"C",ovr:88},
{name:"CJ McCollum",pos:"SG",ovr:87},
{name:"Jrue Holiday",pos:"PG",ovr:88},
{name:"Shai Gilgeous-Alexander",pos:"PG",ovr:89},
{name:"Michael Porter Jr.",pos:"SF",ovr:87},
{name:"De'Aaron Fox",pos:"PG",ovr:88},
{name:"Pascal Siakam",pos:"PF",ovr:89},
{name:"John Wall",pos:"PG",ovr:86},
{name:"Fred VanVleet",pos:"PG",ovr:87},
{name:"Malcolm Brogdon",pos:"SG",ovr:86},
{name:"Kristaps Porzingis",pos:"PF",ovr:88},
{name:"Draymond Green",pos:"PF",ovr:87},
{name:"Mikal Bridges",pos:"SF",ovr:86},
{name:"Lonzo Ball",pos:"PG",ovr:85},
{name:"D'Angelo Russell",pos:"PG",ovr:86},
{name:"Rudy Gay",pos:"SF",ovr:84},
{name:"Eric Gordon",pos:"SG",ovr:84},
{name:"Tobias Harris",pos:"PF",ovr:87},
{name:"Carmelo Anthony",pos:"SF",ovr:85},
{name:"Brook Lopez",pos:"C",ovr:85},
{name:"Clint Capela",pos:"C",ovr:86},
{name:"Julius Randle",pos:"PF",ovr:88},
{name:"Tyrese Haliburton",pos:"PG",ovr:87},
{name:"Anthony Edwards",pos:"SG",ovr:87},
{name:"OG Anunoby",pos:"SF",ovr:86},
{name:"Al Horford",pos:"C",ovr:85},
{name:"Jonas Valanciunas",pos:"C",ovr:84},
{name:"Dejounte Murray",pos:"PG",ovr:86},
{name:"Kristaps Porzingis",pos:"PF",ovr:88},
{name:"John Collins",pos:"PF",ovr:85},
{name:"Jaren Jackson Jr.",pos:"PF",ovr:87},
{name:"Tyler Herro",pos:"SG",ovr:85},
{name:"Collin Sexton",pos:"PG",ovr:84},
{name:"Buddy Hield",pos:"SG",ovr:84},
{name:"Domantas Sabonis",pos:"C",ovr:87},
{name:"Miles Bridges",pos:"SF",ovr:85},
{name:"Mitchell Robinson",pos:"C",ovr:83},
{name:"Darius Garland",pos:"PG",ovr:86},
{name:"Tyrese Maxey",pos:"PG",ovr:85},
{name:"Jalen Green",pos:"SG",ovr:83},
{name:"Anthony Tolliver",pos:"PF",ovr:80},
{name:"Cade Cunningham",pos:"PG",ovr:86},
{name:"Jabari Smith Jr.",pos:"PF",ovr:84},
{name:"Paolo Banchero",pos:"PF",ovr:85},
{name:"Jalen Williams",pos:"SF",ovr:83},
{name:"Scoot Henderson",pos:"PG",ovr:82},
{name:"Keegan Murray",pos:"PF",ovr:83},
{name:"Victor Wembanyama",pos:"C",ovr:89},
{name:"Bojan Bogdanovic",pos:"SF",ovr:83},
{name:"Kristaps Porzingis",pos:"PF",ovr:88},
{name:"Jordan Poole",pos:"SG",ovr:84},
{name:"Malik Beasley",pos:"SG",ovr:82},
{name:"Devin Vassell",pos:"SF",ovr:84},
{name:"Jae'Sean Tate",pos:"PF",ovr:82},
{name:"Gary Trent Jr.",pos:"SG",ovr:83},
{name:"Keon Johnson",pos:"SG",ovr:80},
{name:"Jusuf Nurkic",pos:"C",ovr:84},
{name:"Dwight Howard",pos:"C",ovr:82},
];

// 球隊資料
const teamData = {Warriors:[],Lakers:[],Celtics:[],Nuggets:[],Bucks:[]};

let playerTeam=null;
let roster=[];
let pool=[];
let aiTeams={};
let selectedRosterIndex=null;
let selectedFreeAgentIndices=[];
let currentSalary=0;
let aiView=false;
let newDraftThisSeason=[];

// ===== 工具 =====
function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}

// ===== 初始化自由球員池 =====
function initPool(){
 pool=[];
 shuffle(nbaPlayers);
 let count=randInt(INITIAL_POOL_MIN,INITIAL_POOL_MAX);
 for(let i=0;i<count;i++){
   let p={...nbaPlayers[i],age:18,salary:randInt(5,15),trade:false};
   pool.push(p);
 }
}

// ===== DOMContentLoaded =====
window.addEventListener("DOMContentLoaded", () => {
  // 選隊選單
  const sel = document.getElementById("teamSelect");
  Object.keys(teamData).forEach(t => {
    let o = document.createElement("option");
    o.value = t;
    o.textContent = t;
    sel.appendChild(o);
  });
  // 讀取存檔
  loadGame();
});

// ===== 選隊 =====
function selectTeam(){
 playerTeam=document.getElementById("teamSelect").value;
 document.getElementById("buildTeam").style.display="block";
 document.getElementById("salaryInfo").textContent="薪資上限 $"+SALARY_CAP+"M，當前 $0M";
 initPool();
 renderPool();
 renderRosterTable();
 document.getElementById("selectTeamUI").style.display="none";
}

// ===== 建隊 / GM 生涯其餘邏輯保持 v0.7.3 功能 =====
// 訓練、多選簽約、模擬下一季、新秀生成、AI 簽約、防止 undefined 等功能
// 請直接沿用 v0.7.3 完整 JS，僅把選隊初始化修正為 DOMContentLoaded 事件

</script>
</body>
</html>
