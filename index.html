<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NBA GM Simulator v0.8</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; margin:0; padding:0; }
#screen { padding: 20px; }
button { margin: 2px; padding:5px 10px; }
section { margin-bottom: 20px; }
</style>
</head>
<body>
<div id="screen"></div>

<script>
// ===== NBA 隊名 & 球員資料 =====
const NBA_TEAMS = [
  "Atlanta Hawks","Boston Celtics","Brooklyn Nets","Charlotte Hornets",
  "Chicago Bulls","Cleveland Cavaliers","Dallas Mavericks","Denver Nuggets",
  "Detroit Pistons","Golden State Warriors","Houston Rockets","Indiana Pacers",
  "Los Angeles Clippers","Los Angeles Lakers","Memphis Grizzlies","Miami Heat",
  "Milwaukee Bucks","Minnesota Timberwolves","New Orleans Pelicans","New York Knicks",
  "Oklahoma City Thunder","Orlando Magic","Philadelphia 76ers","Phoenix Suns",
  "Portland Trail Blazers","Sacramento Kings","San Antonio Spurs","Toronto Raptors",
  "Utah Jazz","Washington Wizards"
];

const REAL_NBA_PLAYERS = [
  { name: "Stephen Curry", pos: "PG", baseOvr: 88 },
  { name: "LeBron James", pos: "SF", baseOvr: 90 },
  { name: "Kevin Durant", pos: "PF", baseOvr: 89 },
  { name: "James Harden", pos: "SG", baseOvr: 86 },
  { name: "Kawhi Leonard", pos: "SF", baseOvr: 87 },
  { name: "Draymond Green", pos: "PF", baseOvr: 82 },
  { name: "Klay Thompson", pos: "SG", baseOvr: 84 },
  { name: "Jimmy Butler", pos: "SF", baseOvr: 86 },
  { name: "Jrue Holiday", pos: "PG", baseOvr: 83 },
  { name: "Brook Lopez", pos: "C", baseOvr: 81 }
];

// ===== 遊戲狀態 =====
let gameState = {
  season: 1,
  selectedTeam: null,
  roster: [],
  freeAgents: [],
  futurePlayers: [],
  aiTeams: {},
  draftedThisSeason: 0
};

// ===== 工具函式 =====
function createPlayer(raw) {
  if (!raw || !raw.name) return null;
  return { name: raw.name, pos: raw.pos||"N/A", age: raw.age??18, ovr: raw.ovr??raw.baseOvr??60, salary: raw.salary??5 };
}

// ===== 初始化 AI 球隊 =====
function initAITeams() {
  NBA_TEAMS.forEach(team => gameState.aiTeams[team] = { roster: [] });
}

// ===== 初始化球員 =====
function initPlayers() {
  const shuffled = [...REAL_NBA_PLAYERS].sort(()=>Math.random()-0.5);
  gameState.freeAgents = shuffled.slice(0,6).map(p=>createPlayer({...p, age:18}));
  gameState.futurePlayers = shuffled.slice(6);
}

// ===== 選隊伍 =====
function selectTeam(teamName) {
  gameState.selectedTeam = teamName;
  alert(`你選擇了 ${teamName}`);
  render();
}

// ===== 選球員 =====
function signPlayer(index) {
  if (gameState.draftedThisSeason>=2){ alert("本季最多簽兩位球員"); return; }
  const raw = gameState.freeAgents[index];
  const player = createPlayer(raw);
  if (!player){ console.error("簽約失敗", raw); return; }
  gameState.roster.push(player);
  gameState.freeAgents.splice(index,1);
  gameState.draftedThisSeason++;
  render();
}

// ===== 完成簽約 =====
function finishSigning() {
  distributeRemainingPlayers();
  gameState.freeAgents = [];
  gameState.draftedThisSeason=0;
  alert("本季簽約完成");
  render();
}

// ===== 分配剩餘球員給 AI =====
function distributeRemainingPlayers() {
  const aiNames = Object.keys(gameState.aiTeams).filter(n=>n!==gameState.selectedTeam);
  gameState.freeAgents.forEach((raw,i)=>{
    const player = createPlayer(raw);
    if(!player) return;
    const teamName = aiNames[i%aiNames.length];
    if(!gameState.aiTeams[teamName].roster) gameState.aiTeams[teamName].roster=[];
    if(gameState.aiTeams[teamName].roster.length<2) gameState.aiTeams[teamName].roster.push(player);
  });
}

// ===== 新賽季 =====
function nextSeason() {
  gameState.season++;
  // 玩家與 AI 球員年齡增長
  gameState.roster.forEach(p=>p.age++);
  Object.values(gameState.aiTeams).forEach(team=>team.roster.forEach(p=>p.age++));
  // 新秀生成
  const rookies = gameState.futurePlayers.splice(0,3).map(p=>createPlayer({...p, age:18}));
  gameState.freeAgents = rookies;
  gameState.draftedThisSeason=0;
  alert("新賽季開始，生成新秀");
  render();
}

// ===== 渲染畫面 =====
function render(){
  const screen = document.getElementById("screen");
  // 選隊伍畫面
  if(!gameState.selectedTeam){
    screen.innerHTML = `<h2>NBA GM Simulator v0.8</h2>
    <p>請選擇你的球隊:</p>
    ${NBA_TEAMS.map(t=>`<button onclick="selectTeam('${t}')">${t}</button>`).join("<br>")}`;
    return;
  }

  // 遊戲畫面
  screen.innerHTML = `<h2>NBA GM Simulator v0.8</h2>
  <p>賽季: ${gameState.season}</p>
  <div class="roster"><b>你的隊伍 (${gameState.selectedTeam}):</b><br>${gameState.roster.map(p=>p.name+" ("+p.age+"歲)").join("<br>")||"空"}</div>
  <div class="freeagents"><b>自由球員池:</b><br>${gameState.freeAgents.map((p,i)=>`<button onclick="signPlayer(${i})">選 ${p.name}</button>`).join("<br>")||"空"}</div>
  <button onclick="finishSigning()">完成簽約</button>
  <button onclick="nextSeason()">新賽季</button>
  <div class="ai-teams"><b>AI 球隊:</b><br>${Object.entries(gameState.aiTeams).map(([name,team])=>`${name}: ${team.roster.map(p=>p.name+"("+p.age+")").join(", ")||"空"}`).join("<br>")}</div>`;
}

// ===== 遊戲開始 =====
initAITeams();
initPlayers();
render();
</script>
</body>
</html>
