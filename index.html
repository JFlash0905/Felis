<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>NBA GM Simulator</title>
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; }
#app { max-width: 900px; margin:auto; padding:20px; }
section { background:#fff; padding:12px; margin-bottom:12px; border-radius:6px; }
button { padding:6px 10px; margin:4px 0; }
select { padding:4px; }
</style>
</head>
<body>
<div id="app"></div>

<script>
// ================= 基本資料 =================
const NBA_TEAMS = [
 "Atlanta Hawks","Boston Celtics","Brooklyn Nets","Charlotte Hornets",
 "Chicago Bulls","Cleveland Cavaliers","Dallas Mavericks","Denver Nuggets",
 "Detroit Pistons","Golden State Warriors","Houston Rockets","Indiana Pacers",
 "LA Clippers","LA Lakers","Memphis Grizzlies","Miami Heat",
 "Milwaukee Bucks","Minnesota Timberwolves","New Orleans Pelicans","New York Knicks",
 "Oklahoma City Thunder","Orlando Magic","Philadelphia 76ers","Phoenix Suns",
 "Portland Trail Blazers","Sacramento Kings","San Antonio Spurs","Toronto Raptors",
 "Utah Jazz","Washington Wizards"
];

const NBA_PLAYER_POOL = [
 {name:"Stephen Curry",pos:"PG",ovr:88},
 {name:"LeBron James",pos:"SF",ovr:90},
 {name:"Kevin Durant",pos:"PF",ovr:89},
 {name:"Kawhi Leonard",pos:"SF",ovr:87},
 {name:"James Harden",pos:"SG",ovr:86},
 {name:"Jayson Tatum",pos:"SF",ovr:85},
 {name:"Devin Booker",pos:"SG",ovr:84},
 {name:"Jimmy Butler",pos:"SF",ovr:86},
 {name:"Klay Thompson",pos:"SG",ovr:84},
 {name:"Draymond Green",pos:"PF",ovr:82},
 {name:"Ja Morant",pos:"PG",ovr:83},
 {name:"Donovan Mitchell",pos:"SG",ovr:84},
 {name:"Trae Young",pos:"PG",ovr:83},
 {name:"Bam Adebayo",pos:"C",ovr:82},
 {name:"Jrue Holiday",pos:"PG",ovr:83},
 {name:"Brook Lopez",pos:"C",ovr:81},
 {name:"Paul George",pos:"SF",ovr:85},
 {name:"Karl-Anthony Towns",pos:"C",ovr:84},
 {name:"Zach LaVine",pos:"SG",ovr:82},
 {name:"Rudy Gobert",pos:"C",ovr:85}
];

const MIN_ROSTER_SIZE = 8;

// ================= 狀態 =================
let futureNBAPlayers = [...NBA_PLAYER_POOL];
let gameState = {
 season: 1,
 team: null,
 roster: [],
 aiTeams: {},
 freeAgents: [],
 drafted: 0,
 gamesPlayed: 0,
 totalGames: 30,
 wins: 0,
 losses: 0
};

// ================= 工具 =================
function createPlayer(tpl, age=18){
 if(!tpl || !tpl.name) return null;
 return {name:tpl.name,pos:tpl.pos,ovr:tpl.ovr,age,salary:5};
}

function teamPower(roster){
 if(roster.length===0) return 0;
 return roster.reduce((s,p)=>s+p.ovr,0)/roster.length;
}

// ================= 初始化 =================
NBA_TEAMS.forEach(t=>gameState.aiTeams[t]={roster:[]});

function startSeason(){
 gameState.freeAgents=[];
 for(let i=0;i<Math.min(6,futureNBAPlayers.length);i++){
  gameState.freeAgents.push(createPlayer(futureNBAPlayers.shift(),18));
 }
 gameState.drafted=0;
}

// ================= 簽約 =================
function signPlayer(i){
 if(gameState.drafted>=2) return alert("本季最多簽兩人");
 gameState.roster.push(gameState.freeAgents.splice(i,1)[0]);
 gameState.drafted++;
 render();
}

function finishSigning(){
 distributeRemaining();
 render();
}

function distributeRemaining(){
 const others = Object.keys(gameState.aiTeams).filter(t=>t!==gameState.team);
 gameState.freeAgents.forEach((p,i)=>{
  const t = gameState.aiTeams[others[i%others.length]];
  if(t.roster.length<MIN_ROSTER_SIZE) t.roster.push(p);
 });
 gameState.freeAgents=[];
}

// ================= 例行賽 =================
function simulateSeason(){
 while(gameState.gamesPlayed<gameState.totalGames){
  const myP = teamPower(gameState.roster);
  let league=0,c=0;
  Object.values(gameState.aiTeams).forEach(t=>{
   if(t.roster.length){league+=teamPower(t.roster);c++;}
  });
  league=c?league/c:myP;
  Math.random()<myP/(myP+league)?gameState.wins++:gameState.losses++;
  gameState.gamesPlayed++;
 }
 alert(`例行賽結束：${gameState.wins}勝 ${gameState.losses}敗`);
 nextSeason();
}

// ================= 新賽季 =================
function fillTeam(r){
 while(r.length<MIN_ROSTER_SIZE && futureNBAPlayers.length){
  r.push(createPlayer(futureNBAPlayers.shift(),18));
 }
}

function nextSeason(){
 gameState.season++;
 gameState.gamesPlayed=0;
 gameState.wins=0;
 gameState.losses=0;

 gameState.roster.forEach(p=>p.age++);
 Object.values(gameState.aiTeams).forEach(t=>t.roster.forEach(p=>p.age++));

 startSeason();
 fillTeam(gameState.roster);
 Object.values(gameState.aiTeams).forEach(t=>fillTeam(t.roster));
 render();
}

// ================= UI =================
function selectTeam(){
 gameState.team=document.getElementById("teamSel").value;
 startSeason();
 render();
}

function render(){
 const app=document.getElementById("app");
 if(!gameState.team){
  app.innerHTML=`<h2>選擇球隊</h2>
   <select id="teamSel">${NBA_TEAMS.map(t=>`<option>${t}</option>`).join("")}</select>
   <button onclick="selectTeam()">開始</button>`;
  return;
 }

 app.innerHTML=`
 <h2>第 ${gameState.season} 賽季｜${gameState.team}</h2>

 <section><b>你的球隊</b><br>
 ${gameState.roster.map(p=>`${p.name} (${p.age})`).join("<br>")||"空"}
 </section>

 <section><b>自由球員（可簽 ${2-gameState.drafted} 人）</b><br>
 ${gameState.freeAgents.map((p,i)=>`<button onclick="signPlayer(${i})">${p.name}</button>`).join("<br>")||"無"}
 <br><button onclick="finishSigning()">完成簽約</button>
 </section>

 <section>
 <b>例行賽</b><br>
 進度：${gameState.gamesPlayed}/${gameState.totalGames}<br>
 戰績：${gameState.wins} 勝 ${gameState.losses} 敗<br>
 <button onclick="simulateSeason()">模擬例行賽</button>
 </section>`;
}

render();
</script>
</body>
</html>
