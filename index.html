<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NBA GM Simulator v0.7</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; margin:0; padding:0; }
#screen { padding: 20px; }
button { margin: 2px; padding:5px 10px; }
.roster, .freeagents, .ai-teams { margin-top: 15px; }
</style>
</head>
<body>
<div id="screen"></div>

<script>
// ==== 真實 NBA 球員資料（簡化版，可自行增加） ====
const REAL_NBA_PLAYERS = [
  { name: "Stephen Curry", pos: "PG", baseOvr: 88 },
  { name: "LeBron James", pos: "SF", baseOvr: 90 },
  { name: "Kevin Durant", pos: "PF", baseOvr: 89 },
  { name: "James Harden", pos: "SG", baseOvr: 86 },
  { name: "Kawhi Leonard", pos: "SF", baseOvr: 87 },
  { name: "Draymond Green", pos: "PF", baseOvr: 82 },
  { name: "Klay Thompson", pos: "SG", baseOvr: 84 },
  { name: "Jimmy Butler", pos: "SF", baseOvr: 86 },
  { name: "Jrue Holiday", pos: "PG", baseOvr: 83 },
  { name: "Brook Lopez", pos: "C", baseOvr: 81 }
];

// ==== 全域遊戲狀態 ====
let gameState = {
  season: 1,
  selectedTeam: null,
  roster: [],
  freeAgents: [],
  futurePlayers: [],
  aiTeams: { "Lakers": { roster: [] }, "Bulls": { roster: [] } },
  draftedThisSeason: 0
};

// ==== 工具函式 ====
function createPlayer(raw) {
  if (!raw || !raw.name) return null;
  return {
    name: raw.name,
    pos: raw.pos || "N/A",
    age: raw.age ?? 18,
    ovr: raw.ovr ?? raw.baseOvr ?? 60,
    salary: raw.salary ?? 5
  };
}

// ==== 初始化球員 ====
function initPlayers() {
  const shuffled = [...REAL_NBA_PLAYERS].sort(() => Math.random() - 0.5);
  gameState.freeAgents = shuffled.slice(0,6).map(p => createPlayer({ ...p, age: 18 }));
  gameState.futurePlayers = shuffled.slice(6);
}

// ==== 選球員 ====
function signPlayer(index) {
  if (gameState.draftedThisSeason >= 2) {
    alert("本季最多簽兩位球員");
    return;
  }
  const raw = gameState.freeAgents[index];
  const player = createPlayer(raw);
  if (!player) { console.error("簽約失敗", raw); return; }
  gameState.roster.push(player);
  gameState.freeAgents.splice(index,1);
  gameState.draftedThisSeason++;
  render();
}

// ==== 完成簽約，剩餘球員分配給 AI ====
function finishSigning() {
  distributeRemainingPlayers();
  gameState.freeAgents = [];
  gameState.draftedThisSeason = 0;
  alert("本季簽約完成");
  render();
}

// ==== 分配剩餘球員給 AI（每隊最多 2 人） ====
function distributeRemainingPlayers() {
  const aiTeamNames = Object.keys(gameState.aiTeams);
  gameState.freeAgents.forEach((raw,i) => {
    const player = createPlayer(raw);
    if (!player) return;
    const teamName = aiTeamNames[i % aiTeamNames.length];
    if (!gameState.aiTeams[teamName].roster) gameState.aiTeams[teamName].roster = [];
    if (gameState.aiTeams[teamName].roster.length < 2) {
      gameState.aiTeams[teamName].roster.push(player);
    }
    // 超過 2 人就落選，留到 future pool
  });
}

// ==== 新賽季 ====
function nextSeason() {
  gameState.season++;
  gameState.roster.forEach(p => p.age++);
  const rookies = gameState.futurePlayers.splice(0,3).map(p => createPlayer({ ...p, age: 18 }));
  gameState.freeAgents = rookies;
  gameState.draftedThisSeason = 0;
  alert("新賽季開始，生成新秀");
  render();
}

// ==== 渲染畫面 ====
function render() {
  const screen = document.getElementById("screen");
  screen.innerHTML = `<h2>NBA GM Simulator v0.7</h2>
  <p>賽季: ${gameState.season}</p>
  <div class="roster"><b>你的隊伍:</b><br>${gameState.roster.map(p=>p.name+" ("+p.age+"歲)").join("<br>") || "空"}</div>
  <div class="freeagents"><b>自由球員池:</b><br>${gameState.freeAgents.map((p,i)=>`<button onclick="signPlayer(${i})">選 ${p.name}</button>`).join("<br>") || "空"}</div>
  <button onclick="finishSigning()">完成簽約</button>
  <button onclick="nextSeason()">新賽季</button>
  <div class="ai-teams"><b>AI 球隊:</b><br>${Object.entries(gameState.aiTeams).map(([name,team])=>`${name}: ${team.roster.map(p=>p.name+"("+p.age+")").join(", ") || "空"}`).join("<br>")}</div>
  `;
}

// ==== 開始遊戲 ====
initPlayers();
render();
</script>
</body>
</html>
